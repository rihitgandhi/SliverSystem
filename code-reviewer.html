<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Reviewer - SliverSystem</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .tool-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }
        
        .tool-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .tool-header h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #333;
        }
        
        .tool-header p {
            font-size: 1.2rem;
            color: #666;
        }
        
        .input-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .code-input-area {
            margin: 20px 0;
        }
        
        .code-input-area label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .code-input-area textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            resize: vertical;
        }
        
        .code-input-area textarea:focus {
            outline: none;
            border-color: #4a90e2;
        }
        
        .code-type-selector {
            margin-bottom: 20px;
        }
        
        .code-type-selector label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .code-type-selector select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .review-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .review-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .review-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .results-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }
        
        .results-section.visible {
            display: block;
        }
        
        .score-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .score-summary h2 {
            margin: 0 0 10px 0;
            font-size: 3rem;
        }
        
        .score-summary p {
            margin: 0;
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .issues-section {
            margin: 30px 0;
        }
        
        .issue-card {
            background: white;
            border-left: 4px solid #f44336;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .issue-card.warning {
            border-left-color: #ff9800;
            background: #fff9e6;
        }
        
        .issue-card.info {
            border-left-color: #2196f3;
            background: #e3f2fd;
        }
        
        .issue-card h4 {
            margin: 0 0 15px 0;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .severity-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
        }
        
        .severity-critical {
            background: #f44336;
        }
        
        .severity-high {
            background: #ff9800;
        }
        
        .severity-moderate {
            background: #2196f3;
        }
        
        .issue-description {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        .code-suggestion {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .code-suggestion h5 {
            margin: 0 0 10px 0;
            color: #666;
        }
        
        .code-suggestion pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 0;
        }
        
        .code-suggestion code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .recommendations-section {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 20px;
            border-radius: 5px;
            margin: 30px 0;
        }
        
        .recommendations-section h3 {
            margin-top: 0;
            color: #2e7d32;
        }
        
        .recommendations-section ul {
            margin-bottom: 0;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4a90e2;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .sample-links {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .sample-link {
            padding: 8px 16px;
            background: #e3f2fd;
            color: #1976d2;
            text-decoration: none;
            border-radius: 5px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .sample-link:hover {
            background: #1976d2;
            color: white;
        }
    </style>
</head>
<body class="homepage">
    <div id="content-wrapper">
        <!-- Skip to main content link for screen readers -->
        <a href="#main-content" class="skip-link">Skip to main content</a>
        
        <!-- Navigation -->
    <header role="banner" class="modern-header sticky-header fundamental-nav" style="background: #357abd; box-shadow: 0 2px 12px rgba(53,122,189,0.10); position: sticky; top: 0; z-index: 1001;">
        <nav role="navigation" aria-label="Main navigation">
            <div class="nav-container nav-elevated fundamental-nav-container">
                <div class="nav-brand fundamental-nav-brand">
                    <a href="index.html" aria-label="Go to Home" style="all: unset; cursor: pointer; display: inline-block;">
                        <h1 class="nav-title fundamental-nav-title" style="color: #fff; font-weight: 900; letter-spacing: 1px; font-size: 1.6rem; margin: 0;">AcessAI</h1>
                    </a>
                </div>
                <div class="nav-menu fundamental-nav-menu" role="menubar">
                    <a href="index.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-home"></i></span>
                        <span class="nav-text">Home</span>
                    </a>
                    <a href="index.html#ai" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-robot"></i></span>
                        <span class="nav-text">AI in Accessibility</span>
                    </a>
                    <a href="index.html#blogs" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-pen-nib"></i></span>
                        <span class="nav-text">Blogs</span>
                    </a>
                    <a href="index.html#mission" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-bullseye"></i></span>
                        <span class="nav-text">Our Mission</span>
                    </a>
                    <a href="chat.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-comments"></i></span>
                        <span class="nav-text">Chat with AI</span>
                    </a>
                    <a href="score.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-chart-bar"></i></span>
                        <span class="nav-text">Accessibility Score</span>
                    </a>
                    <a href="alt-text-generator.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-image"></i></span>
                        <span class="nav-text">Alt Text Generator</span>
                    </a>
                    <a href="code-reviewer.html" class="nav-item nav-link active" role="menuitem" aria-current="page">
                        <span class="nav-icon"><i class="fa fa-code"></i></span>
                        <span class="nav-text">Code Reviewer</span>
                    </a>
                    <a href="content-simplifier.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-file-alt"></i></span>
                        <span class="nav-text">Content Simplifier</span>
                    </a>
                    <a href="help.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-question-circle"></i></span>
                        <span class="nav-text">Help</span>
                    </a>
                </div>
                <button class="nav-toggle fundamental-nav-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
                    <span class="hamburger"></span>
                </button>
            </div>
        </nav>
    </header>

    <main id="main-content" role="main" class="tool-container">
        <div class="tool-header">
            <h1>üîç AI Code Reviewer</h1>
            <p>Get instant accessibility feedback on your HTML, CSS, and JavaScript code</p>
        </div>

        <!-- Input Section -->
        <div class="input-section">
            <h2>Paste Your Code</h2>
            
            <div class="code-type-selector">
                <label for="code-type">Code Type:</label>
                <select id="code-type">
                    <option value="html">HTML</option>
                    <option value="css">CSS</option>
                    <option value="jsx">React/JSX</option>
                    <option value="vue">Vue</option>
                    <option value="mixed">Mixed (HTML + CSS)</option>
                </select>
            </div>
            
            <div class="sample-links">
                <span style="font-weight: 600; margin-right: 10px;">Try examples:</span>
                <a href="#" class="sample-link" onclick="loadSample('button'); return false;">Button</a>
                <a href="#" class="sample-link" onclick="loadSample('form'); return false;">Form</a>
                <a href="#" class="sample-link" onclick="loadSample('nav'); return false;">Navigation</a>
                <a href="#" class="sample-link" onclick="loadSample('image'); return false;">Image</a>
            </div>
            
            <div class="code-input-area">
                <label for="code-input">Your Code:</label>
                <textarea id="code-input" placeholder="Paste your HTML, CSS, or JavaScript code here..."></textarea>
            </div>
            
            <button class="review-btn" id="review-btn">
                <span id="btn-text">Review Code</span>
                <span id="btn-spinner" style="display: none;">‚è≥</span>
            </button>
        </div>

        <!-- Loading Spinner -->
        <div class="loading-spinner" id="loading-spinner">
            <div class="spinner"></div>
            <p>Analyzing code for accessibility issues...</p>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="results">
            <div class="score-summary">
                <h2 id="accessibility-score">0/100</h2>
                <p>Accessibility Score</p>
            </div>
            
            <div class="issues-section" id="issues-list">
                <!-- Issues will be populated here -->
            </div>
            
            <div class="recommendations-section" id="recommendations">
                <!-- Recommendations will be populated here -->
            </div>
        </div>
    </main>

    <script>
        const codeInput = document.getElementById('code-input');
        const codeType = document.getElementById('code-type');
        const reviewBtn = document.getElementById('review-btn');
        const btnText = document.getElementById('btn-text');
        const btnSpinner = document.getElementById('btn-spinner');
        const loadingSpinner = document.getElementById('loading-spinner');
        const resultsSection = document.getElementById('results');

        // Determine backend URL
        const hostname = window.location.hostname;
        const backendUrl = hostname === 'rihitgandhi.github.io' 
            ? 'https://sliver-system-backend-production-9067.up.railway.app'
            : window.location.origin;

        // Sample code snippets
        const samples = {
            button: `<button onclick="handleClick()">
    Click me
</button>`,
            form: `<form>
    <input type="text" name="email">
    <button type="submit">Submit</button>
</form>`,
            nav: `<div class="nav">
    <span onclick="goHome()">Home</span>
    <span onclick="goAbout()">About</span>
    <span onclick="goContact()">Contact</span>
</div>`,
            image: `<img src="product.jpg" />
<div style="background-image: url('hero.jpg')">
    Welcome to our site
</div>`
        };

        function loadSample(type) {
            codeInput.value = samples[type];
        }

        // Review code
        reviewBtn.addEventListener('click', async () => {
            const code = codeInput.value.trim();
            
            if (!code) {
                alert('Please paste some code to review');
                return;
            }

            // Show loading
            reviewBtn.disabled = true;
            btnText.textContent = 'Reviewing...';
            btnSpinner.style.display = 'inline';
            loadingSpinner.style.display = 'block';
            resultsSection.classList.remove('visible');

            try {
                const response = await fetch(backendUrl + '/api/review-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code: code,
                        code_type: codeType.value
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displayResults(data);

            } catch (error) {
                console.error('Error:', error);
                alert('Error reviewing code: ' + error.message);
            } finally {
                reviewBtn.disabled = false;
                btnText.textContent = 'Review Code';
                btnSpinner.style.display = 'none';
                loadingSpinner.style.display = 'none';
            }
        });

        function displayResults(data) {
            // Display score
            document.getElementById('accessibility-score').textContent = data.score + '/100';

            // Display issues
            const issuesList = document.getElementById('issues-list');
            issuesList.innerHTML = '<h2>Issues Found</h2>';

            if (data.issues && data.issues.length > 0) {
                data.issues.forEach(issue => {
                    const card = document.createElement('div');
                    card.className = 'issue-card';
                    
                    if (issue.severity === 'High') card.classList.add('warning');
                    if (issue.severity === 'Moderate') card.classList.add('info');
                    
                    let html = `
                        <h4>
                            ${escapeHtml(issue.title)}
                            <span class="severity-badge severity-${issue.severity.toLowerCase()}">${issue.severity}</span>
                        </h4>
                        <p class="issue-description">${escapeHtml(issue.description)}</p>
                        <p><strong>WCAG:</strong> ${escapeHtml(issue.wcag_criterion || 'N/A')}</p>
                    `;
                    
                    if (issue.code_snippet) {
                        html += `
                            <div class="code-suggestion">
                                <h5>‚ùå Current Code:</h5>
                                <pre><code>${escapeHtml(issue.code_snippet)}</code></pre>
                            </div>
                        `;
                    }
                    
                    if (issue.fix) {
                        html += `
                            <div class="code-suggestion">
                                <h5>‚úÖ Suggested Fix:</h5>
                                <pre><code>${escapeHtml(issue.fix)}</code></pre>
                            </div>
                        `;
                    }
                    
                    card.innerHTML = html;
                    issuesList.appendChild(card);
                });
            } else {
                issuesList.innerHTML += '<p>No accessibility issues found! Great job! üéâ</p>';
            }

            // Display recommendations
            const recommendationsDiv = document.getElementById('recommendations');
            recommendationsDiv.innerHTML = '<h3>üí° General Recommendations</h3>';
            
            if (data.recommendations && data.recommendations.length > 0) {
                const ul = document.createElement('ul');
                data.recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    ul.appendChild(li);
                });
                recommendationsDiv.appendChild(ul);
            }

            resultsSection.classList.add('visible');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
    </div>
</body>
</html>
