<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Accessibility Score</title>
    <link rel="stylesheet" href="./css/main.css">
    <style>
        .score-page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .score-form-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .score-form-section h1 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .url-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .url-input-group input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .url-input-group input:focus {
            outline: none;
            border-color: #4a90e2;
        }
        
        .check-btn {
            padding: 12px 30px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .check-btn:hover {
            background: #357abd;
        }
        
        .check-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .message {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }
        
        .message.error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
        }
        
        .message.success {
            background: #efe;
            border: 1px solid #cfc;
            color: #3c3;
        }
        
        .message.info {
            background: #eef;
            border: 1px solid #ccf;
            color: #33c;
        }
        
        .results-container {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .results-container.visible {
            display: block;
        }
        
        .score-display {
            text-align: center;
            margin: 30px 0;
        }
        
        .score-circle {
            display: inline-block;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a90e2, #357abd);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .score-value {
            font-size: 72px;
            font-weight: bold;
        }
        
        .score-label {
            font-size: 24px;
        }
        
        .results-section {
            margin-top: 30px;
        }
        
        .results-section h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 3px solid #4a90e2;
            padding-bottom: 10px;
        }
        
        .results-section h3 {
            color: #4a90e2;
            margin: 25px 0 15px 0;
        }
        
        .wcag-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .wcag-column {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #ddd;
        }
        
        .wcag-column h4 {
            margin-bottom: 15px;
        }
        
        .wcag-item {
            padding: 10px;
            margin: 8px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #4a90e2;
        }
        
        .wcag-item.compliant {
            border-left-color: #4caf50;
        }
        
        .wcag-item.non-compliant {
            border-left-color: #f44336;
        }
        
        .priority-issues {
            margin: 20px 0;
        }
        
        .issue-card {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .issue-card h4 {
            margin: 0 0 15px 0;
            color: #f57c00;
            font-size: 1.3rem;
        }
        
        .issue-meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .severity-critical {
            background: #f44336;
            color: white;
        }
        
        .severity-high {
            background: #ff9800;
            color: white;
        }
        
        .severity-moderate {
            background: #ffeb3b;
            color: #333;
        }
        
        .impact {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .effort {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .time {
            background: #e8f5e9;
            color: #388e3c;
        }
        
        .issue-description {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        .code-examples {
            margin: 15px 0;
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
        }
        
        .code-example {
            margin: 10px 0;
        }
        
        .code-example pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 8px 0 0 0;
        }
        
        .code-example code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .implementation-details,
        .resources-details,
        .testing-details {
            margin: 15px 0;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            background: white;
        }
        
        .implementation-details summary,
        .resources-details summary,
        .testing-details summary {
            cursor: pointer;
            font-weight: 600;
            padding: 8px;
            user-select: none;
        }
        
        .implementation-details summary:hover,
        .resources-details summary:hover,
        .testing-details summary:hover {
            background: #f5f5f5;
        }
        
        .implementation-details ol,
        .testing-details ul {
            margin: 10px 0 0 0;
            padding-left: 25px;
        }
        
        .implementation-details li,
        .testing-details li {
            margin: 8px 0;
            line-height: 1.6;
        }
        
        .resource-list {
            list-style: none;
            padding: 10px 0 0 0;
            margin: 0;
        }
        
        .resource-list li {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .resource-list li:hover {
            background: #e8f4f8;
        }
        
        .resource-list a {
            text-decoration: none;
            color: #1976d2;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .resource-list a:hover {
            color: #0d47a1;
        }
        
        .resource-type {
            color: #666;
            font-size: 0.9rem;
        }
        
        .external-link {
            margin-left: auto;
            font-size: 1.2rem;
        }
        
        .recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .recommendation-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            border-top: 4px solid #4a90e2;
        }
        
        .recommendation-card h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4a90e2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .nav-header {
            background: white;
            padding: 15px 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 10px 20px;
            text-decoration: none;
            color: #333;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .nav-tab:hover {
            background: #f0f0f0;
        }
        
        .nav-tab.active {
            background: #4a90e2;
            color: white;
        }
    </style>
</head>
<body class="homepage">
    <div id="content-wrapper">
        <!-- Skip to main content link for screen readers -->
        <a href="#main-content" class="skip-link">Skip to main content</a>
        
        <!-- Navigation -->
    <header role="banner" class="modern-header sticky-header fundamental-nav" style="background: #357abd; box-shadow: 0 2px 12px rgba(53,122,189,0.10); position: sticky; top: 0; z-index: 1001;">
        <nav role="navigation" aria-label="Main navigation">
            <div class="nav-container nav-elevated fundamental-nav-container">
                <div class="nav-brand fundamental-nav-brand">
                    <a href="index.html" aria-label="Go to Home" style="all: unset; cursor: pointer; display: inline-block;">
                        <h1 class="nav-title fundamental-nav-title" style="color: #fff; font-weight: 900; letter-spacing: 1px; font-size: 1.6rem; margin: 0;">AcessAI</h1>
                    </a>
                </div>
                <div class="nav-menu fundamental-nav-menu" role="menubar">
                    <a href="index.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-home"></i></span>
                        <span class="nav-text">Home</span>
                    </a>
                    <a href="index.html#ai" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-robot"></i></span>
                        <span class="nav-text">AI in Accessibility</span>
                    </a>
                    <a href="index.html#blogs" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-pen-nib"></i></span>
                        <span class="nav-text">Blogs</span>
                    </a>
                    <a href="index.html#mission" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-bullseye"></i></span>
                        <span class="nav-text">Our Mission</span>
                    </a>
                    <a href="chat.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-comments"></i></span>
                        <span class="nav-text">Chat with AI</span>
                    </a>
                    <a href="score.html" class="nav-item nav-link active" role="menuitem" aria-current="page">
                        <span class="nav-icon"><i class="fa fa-chart-bar"></i></span>
                        <span class="nav-text">Accessibility Score</span>
                    </a>
                    <a href="alt-text-generator.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-image"></i></span>
                        <span class="nav-text">Alt Text Generator</span>
                    </a>
                    <a href="code-reviewer.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-code"></i></span>
                        <span class="nav-text">Code Reviewer</span>
                    </a>
                    <a href="content-simplifier.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-file-alt"></i></span>
                        <span class="nav-text">Content Simplifier</span>
                    </a>
                    <a href="help.html" class="nav-item nav-link" role="menuitem">
                        <span class="nav-icon"><i class="fa fa-question-circle"></i></span>
                        <span class="nav-text">Help</span>
                    </a>
                </div>
                <button class="nav-toggle fundamental-nav-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
                    <span class="hamburger"></span>
                </button>
            </div>
        </nav>
    </header>

    <main id="main-content" role="main">
        <div class="score-page-container">
            <!-- Form Section -->
            <div class="score-form-section">
            <h1>Website Accessibility Score</h1>
            <p>Enter a website URL to analyze its accessibility compliance with WCAG 2.1 Level AA standards.</p>
            
            <div style="margin-top: 20px;">
                <div class="url-input-group">
                    <input 
                        type="url" 
                        id="url-input" 
                        placeholder="https://example.com"
                        autocomplete="off"
                    >
                    <button type="button" id="analyze-btn" class="check-btn">
                        <span id="btn-text">Check Accessibility</span>
                        <span id="btn-spinner" class="loading-spinner" style="display: none;"></span>
                    </button>
                </div>
                
                <div id="progress-text" style="text-align: center; margin-top: 10px; color: #666; font-size: 14px; min-height: 20px; font-style: italic;"></div>
                
                <div id="message" class="message"></div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="results-container">
            <h2>Accessibility Analysis Results</h2>
            
            <!-- Score Display -->
            <div class="score-display">
                <div class="score-circle">
                    <div class="score-value" id="score-value">0</div>
                    <div class="score-label">/100</div>
                </div>
            </div>
            
            <div class="results-section">
                <!-- Score Explanation -->
                <div id="score-explanation"></div>
                
                <!-- WCAG Standards -->
                <div id="wcag-section">
                    <h2>WCAG 2.1 Level AA Compliance</h2>
                    <div class="wcag-grid">
                        <div class="wcag-column">
                            <h4>‚úÖ Compliant Standards</h4>
                            <div id="compliant-list"></div>
                        </div>
                        <div class="wcag-column">
                            <h4>‚ùå Non-Compliant Standards</h4>
                            <div id="non-compliant-list"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Priority Issues -->
                <div id="priority-section">
                    <h2>Priority Issues</h2>
                    <div id="priority-list" class="priority-issues"></div>
                </div>
                
                <!-- Recommendations -->
                <h2>Recommendations</h2>
                <div class="recommendations">
                    <div class="recommendation-card">
                        <h3>Short-term (1-2 weeks)</h3>
                        <div id="short-term"></div>
                    </div>
                    <div class="recommendation-card">
                        <h3>Medium-term (1-3 months)</h3>
                        <div id="medium-term"></div>
                    </div>
                    <div class="recommendation-card">
                        <h3>Long-term (3-12 months)</h3>
                        <div id="long-term"></div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <p>Need help understanding these recommendations? 
                        <a href="help.html" style="color: #4a90e2;">View our comprehensive help guide</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize
        console.log('Score page loaded successfully');
        console.log('Current URL:', window.location.href);
        console.log('Page title:', document.title);
        
        // Check for URL parameter and auto-fill
        const urlParams = new URLSearchParams(window.location.search);
        const prefilledUrl = urlParams.get('url');
        
        // Detect any navigation attempts
        window.addEventListener('beforeunload', function(e) {
            console.log('WARNING: Page is about to unload/navigate!');
            console.log('New URL would be:', window.location.href);
        });
        
        const urlInput = document.getElementById('url-input');
        const analyzeBtn = document.getElementById('analyze-btn');
        const btnText = document.getElementById('btn-text');
        const btnSpinner = document.getElementById('btn-spinner');
        const messageDiv = document.getElementById('message');
        const resultsDiv = document.getElementById('results');
        const progressText = document.getElementById('progress-text');

        // Pre-fill URL if provided in query parameter
        if (prefilledUrl) {
            urlInput.value = prefilledUrl;
            console.log('Pre-filled URL from parameter:', prefilledUrl);
            // Optionally auto-run the check
            // setTimeout(() => analyzeBtn.click(), 500);
        }

        // Determine backend URL
        const hostname = window.location.hostname;
        const backendUrl = hostname === 'rihitgandhi.github.io' 
            ? 'https://sliver-system-backend-production-9067.up.railway.app'
            : window.location.origin;
        
        console.log('Backend URL:', backendUrl);

        // Progress messages that rotate every 5 seconds
        const progressMessages = [
            'Analyzing website structure...',
            'Checking color contrast ratios...',
            'Evaluating heading hierarchy...',
            'Scanning for alt text on images...',
            'Testing keyboard navigation...',
            'Validating ARIA attributes...',
            'Checking form accessibility...',
            'Analyzing semantic HTML...',
            'Testing focus indicators...',
            'Evaluating link descriptions...',
            'Finalizing accessibility report...'
        ];
        
        let progressInterval = null;
        let currentMessageIndex = 0;

        // Handle button click
        analyzeBtn.addEventListener('click', async function() {
            console.log('Analyze button clicked');
            console.log('urlInput element:', urlInput);
            console.log('urlInput.value:', urlInput.value);
            
            let url = urlInput.value.trim();
            console.log('Trimmed URL:', url);
            console.log('URL length:', url.length);
            
            if (!url) {
                console.log('URL is empty - showing error');
                showMessage('Please enter a valid URL', 'error');
                return;
            }
            
            // Automatically add https:// if no protocol is specified
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
                urlInput.value = url; // Update the input field to show the full URL
                console.log('Added https:// to URL:', url);
            }
            
            // Start analysis
            analyzeBtn.disabled = true;
            currentMessageIndex = 0;
            btnText.textContent = 'Analyzing...';
            btnSpinner.style.display = 'inline-block';
            progressText.textContent = progressMessages[0];
            resultsDiv.classList.remove('visible');
            hideMessage();
            
            // Start rotating progress messages
            progressInterval = setInterval(() => {
                currentMessageIndex = (currentMessageIndex + 1) % progressMessages.length;
                progressText.textContent = progressMessages[currentMessageIndex];
            }, 5000);
            
            try {
                console.log('Sending request to:', backendUrl + '/api/score');
                
                const response = await fetch(backendUrl + '/api/score', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Response data:', data);
                
                // Check if response has the expected structure
                if (data.score !== undefined) {
                    displayResults(data);
                    showMessage('Analysis completed successfully!', 'success');
                } else if (data.error) {
                    showMessage(data.error || 'Analysis failed', 'error');
                } else {
                    showMessage('Unexpected response format', 'error');
                    console.error('Unexpected data format:', data);
                }
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('Error: ' + error.message, 'error');
            } finally {
                // Clear progress interval
                if (progressInterval) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
                
                // Reset button
                analyzeBtn.disabled = false;
                btnText.textContent = 'Check Accessibility';
                btnSpinner.style.display = 'none';
                progressText.textContent = '';
            }
        });
        
        // Allow Enter key in input
        urlInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();  // Prevent any default form behavior
                console.log('Enter key pressed - triggering analyze');
                analyzeBtn.click();
            }
        });
        
        // Also handle keydown as backup
        urlInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();  // Prevent any default form behavior
                console.log('Enter keydown - triggering analyze');
                analyzeBtn.click();
            }
        });
        
        function showMessage(text, type) {
            messageDiv.textContent = text;
            messageDiv.className = 'message ' + type;
            messageDiv.style.display = 'block';
        }
        
        function hideMessage() {
            messageDiv.style.display = 'none';
        }
        
        function displayResults(data) {
            // Show results container
            resultsDiv.classList.add('visible');
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
            
            // Display score
            document.getElementById('score-value').textContent = data.score || 0;
            
            // Display explanation
            const explanationDiv = document.getElementById('score-explanation');
            if (data.score_explanation) {
                explanationDiv.innerHTML = '<h3>Score Explanation</h3><p>' + escapeHtml(data.score_explanation) + '</p>';
            }
            
            // Display WCAG standards
            if (data.wcag_standards) {
                displayWCAGStandards(data.wcag_standards);
            }
            
            // Display priority issues
            if (data.priority_issues) {
                displayPriorityIssues(data.priority_issues);
            }
            
            // Display recommendations
            if (data.recommendations) {
                displayRecommendations(data.recommendations);
            }
        }
        
        function displayWCAGStandards(wcag) {
            const compliantList = document.getElementById('compliant-list');
            const nonCompliantList = document.getElementById('non-compliant-list');
            
            compliantList.innerHTML = '';
            nonCompliantList.innerHTML = '';
            
            // Handle compliant standards
            if (wcag.compliant && wcag.compliant.length > 0) {
                wcag.compliant.forEach(code => {
                    const div = document.createElement('div');
                    div.className = 'wcag-item compliant';
                    const description = wcag.details && wcag.details[code] ? wcag.details[code] : 'Compliant';
                    div.innerHTML = '<strong>' + escapeHtml(code) + '</strong>: ' + escapeHtml(description);
                    compliantList.appendChild(div);
                });
            } else {
                compliantList.innerHTML = '<p>No compliant standards found.</p>';
            }
            
            // Handle non-compliant standards
            if (wcag.non_compliant && wcag.non_compliant.length > 0) {
                wcag.non_compliant.forEach(code => {
                    const div = document.createElement('div');
                    div.className = 'wcag-item non-compliant';
                    const description = wcag.details && wcag.details[code] ? wcag.details[code] : 'Non-compliant';
                    div.innerHTML = '<strong>' + escapeHtml(code) + '</strong>: ' + escapeHtml(description);
                    nonCompliantList.appendChild(div);
                });
            } else {
                nonCompliantList.innerHTML = '<p>No non-compliant standards found.</p>';
            }
            
            // Handle partially compliant standards
            if (wcag.partially_compliant && wcag.partially_compliant.length > 0) {
                wcag.partially_compliant.forEach(code => {
                    const div = document.createElement('div');
                    div.className = 'wcag-item non-compliant';
                    const description = wcag.details && wcag.details[code] ? wcag.details[code] : 'Partially compliant';
                    div.innerHTML = '<strong>' + escapeHtml(code) + '</strong>: ' + escapeHtml(description) + ' <em>(Partially Compliant)</em>';
                    nonCompliantList.appendChild(div);
                });
            }
        }
        
        function displayPriorityIssues(issues) {
            const priorityList = document.getElementById('priority-list');
            priorityList.innerHTML = '';
            
            if (issues && issues.length > 0) {
                issues.forEach(issue => {
                    const card = document.createElement('div');
                    card.className = 'issue-card';
                    
                    let html = `
                        <h4>${escapeHtml(issue.title || 'Issue')}</h4>
                        <div class="issue-meta">
                            <span class="badge severity-${(issue.severity || '').toLowerCase()}">${escapeHtml(issue.severity || 'N/A')}</span>
                            <span class="badge impact">${escapeHtml(issue.impact || 'N/A')} Impact</span>
                            <span class="badge effort">${escapeHtml(issue.effort || 'N/A')} Effort</span>
                            ${issue.estimated_time ? '<span class="badge time">‚è±Ô∏è ' + escapeHtml(issue.estimated_time) + '</span>' : ''}
                        </div>
                        <p><strong>WCAG Criterion:</strong> ${escapeHtml(issue.wcag_criterion || 'N/A')}</p>
                        <p class="issue-description">${escapeHtml(issue.description || '')}</p>
                        ${issue.affected_elements ? '<p><strong>Affected Elements:</strong> ' + escapeHtml(issue.affected_elements) + '</p>' : ''}
                    `;
                    
                    // Show code examples if available
                    if (issue.current_code || issue.fixed_code) {
                        html += '<div class="code-examples">';
                        if (issue.current_code) {
                            html += '<div class="code-example"><strong>‚ùå Current Code:</strong><pre><code>' + escapeHtml(issue.current_code) + '</code></pre></div>';
                        }
                        if (issue.fixed_code) {
                            html += '<div class="code-example"><strong>‚úÖ Fixed Code:</strong><pre><code>' + escapeHtml(issue.fixed_code) + '</code></pre></div>';
                        }
                        html += '</div>';
                    }
                    
                    // Show implementation steps if available
                    if (issue.implementation_steps && issue.implementation_steps.length > 0) {
                        html += '<details class="implementation-details"><summary><strong>üìã Implementation Steps</strong></summary><ol>';
                        issue.implementation_steps.forEach(step => {
                            html += '<li>' + escapeHtml(step) + '</li>';
                        });
                        html += '</ol></details>';
                    }
                    
                    // Show resources if available
                    if (issue.resources && issue.resources.length > 0) {
                        html += '<details class="resources-details" open><summary><strong>üìö Learning Resources</strong></summary><ul class="resource-list">';
                        issue.resources.forEach(resource => {
                            html += '<li><a href="' + escapeHtml(resource.url || '#') + '" target="_blank" rel="noopener noreferrer">' +
                                    '<strong>' + escapeHtml(resource.title || 'Resource') + '</strong> ' +
                                    '<span class="resource-type">(' + escapeHtml(resource.type || 'Link') + ')</span>' +
                                    '<span class="external-link">‚Üó</span></a></li>';
                        });
                        html += '</ul></details>';
                    }
                    
                    // Show testing tools if available
                    if (issue.testing_tools && issue.testing_tools.length > 0) {
                        html += '<details class="testing-details"><summary><strong>üîß Testing Tools</strong></summary><ul>';
                        issue.testing_tools.forEach(tool => {
                            html += '<li>' + escapeHtml(tool) + '</li>';
                        });
                        html += '</ul></details>';
                    }
                    
                    card.innerHTML = html;
                    priorityList.appendChild(card);
                });
            } else {
                priorityList.innerHTML = '<p>No priority issues identified.</p>';
            }
        }
        
        function displayRecommendations(recommendations) {
            if (recommendations.short_term) {
                document.getElementById('short-term').innerHTML = '<p>' + escapeHtml(recommendations.short_term) + '</p>';
            }
            
            if (recommendations.medium_term) {
                document.getElementById('medium-term').innerHTML = '<p>' + escapeHtml(recommendations.medium_term) + '</p>';
            }
            
            if (recommendations.long_term) {
                document.getElementById('long-term').innerHTML = '<p>' + escapeHtml(recommendations.long_term) + '</p>';
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        console.log('All event listeners attached successfully');
        
        // Prevent accidental navigation away from score page
        document.querySelectorAll('.nav-tab').forEach(tab => {
            if (tab.getAttribute('href') !== 'score.html') {
                tab.addEventListener('click', function(e) {
                    // Only warn if user has entered a URL
                    if (urlInput.value.trim()) {
                        const confirmed = confirm('You have entered a URL. Are you sure you want to leave this page?');
                        if (!confirmed) {
                            e.preventDefault();
                            console.log('Navigation cancelled by user');
                        }
                    }
                });
            }
        });
    </script>
        </div>
    </main>
    </div>
</body>
</html>
